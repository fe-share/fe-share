# Reflow和Repaint

## Reflow

回流(Reflow)指的是根据Render Tree重新布局，意味着元素的内容、结构、位置或尺寸发生了变化，需要重新计算样式和渲染树。

### 触发回流的操作

  * 页面第一次渲染
  * DOM树变化
  * Render树变化
  * 窗口resize
  * 获取元素某些属性

但是不是每次回流都会立即触发layout和paint，浏览器会对回流做优化，等到足够数量的变化发生，再做一次批处理回流

同时，有时候浏览器为了获取正确的某些属性的值会提前触发回流，如获取`offset/scroll/cilent属性、使用getCpmputedStyle()`


`注:回流的开销要大于重绘(Repaint)`

## Repaint

重绘指的是元素发生的改变只影响了节点的一些样式，只需要应用新样式绘制这个元素就可以了(即位置，大小没有改变)

### 触发重绘的操作

  * 背景色改变
  * 颜色改变
  * 字体改变(不包括字体大小改变)

`注：Reflow必定引起Repaint`  

## 优化方案

既然Reflow的开销大于Repaint，那么如何尽可能避免Reflow来优化页面性能呢？

1. 避免逐个修改节点样式，尽量一次性修改(通过类名)
2. 使用DocumentFragment将需要多次修改的DOM元素缓存，最后一次性添加到真实DOM中
3. 可以将需要多次修改的DOM元素设置display: none，操作完再显示(隐藏元素不会触发回流)
4. 避免多次读取某些属性
5. 将复杂节点元素脱离文档流，降低回流成本